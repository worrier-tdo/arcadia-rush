(function(){const canvas=document.getElementById('game');if(!canvas)return;const c=canvas.getContext('2d');function resize(){const ratio=960/540;const w=Math.min(canvas.parentElement.clientWidth,960);const h=Math.round(w/ratio);canvas.width=960;canvas.height=540;canvas.style.width=w+'px';canvas.style.height=h+'px'}window.addEventListener('resize',resize);resize();const W=()=>canvas.width,H=()=>canvas.height;let running=true,paused=false;let score=0,high=parseInt(localStorage.getItem('ar_high')||'0',10);const groundY=H()-90;const player={x:140,y:groundY,vy:0,w:46,h:46,onGround:true};const gravity=0.9,jumpV=-17;const obstacles=[],stars=[];let t=0,speed=8;function jump(){if(player.onGround){player.vy=jumpV;player.onGround=false}}window.addEventListener('keydown',e=>{if([' ','ArrowUp','w','W'].includes(e.key)){e.preventDefault();jump()}if(e.key==='p'||e.key==='P'){paused=!paused}if(e.key==='r'||e.key==='R'){restart()}},{passive:false});canvas.addEventListener('pointerdown',jump);const clamp=(v,a,b)=>Math.max(a,Math.min(b,v));function rects(a,b){
  return a.x < b.x + b.w && a.x + a.w > b.x && a.y < b.y + b.h && a.y + a.h > b.y;
}
function shrink(box, pad){
  return {x: box.x + pad, y: box.y + pad, w: Math.max(0, box.w - 2*pad), h: Math.max(0, box.h - 2*pad)};
}function spawnObstacle(){const type=Math.random()<0.5?'cactus':'rock';const size=type==='cactus'?40+Math.random()*20:30+Math.random()*12;obstacles.push({x:W()+20,y:groundY-size,w:size,h:size,type})}function spawnStar(){const y=groundY-(120+Math.random()*120);stars.push({x:W()+20,y,w:18,h:18})}function step(){if(!running||paused)return;t++;speed=8+Math.min(10,score/300);player.vy+=gravity;player.y+=player.vy;if(player.y>=groundY){player.y=groundY;player.vy=0;player.onGround=true}player.y=clamp(player.y,0,groundY);if(t%Math.floor(70-Math.min(40,score/15))===0)spawnObstacle();if(t%110===0)spawnStar();for(let i=obstacles.length-1;i>=0;i--){const o=obstacles[i];o.x-=speed;if(o.x<-80)obstacles.splice(i,1);if(rects({x:player.x-23,y:player.y-23,w:46,h:46}, shrink(o, 4))){running=false}}for(let i=stars.length-1;i>=0;i--){const s=stars[i];s.x-=speed*0.9;if(s.x<-40)stars.splice(i,1);if(rects({x:player.x-23,y:player.y-23,w:46,h:46},s)){score+=25;stars.splice(i,1)}}score+=0.2}function drawBG(now){c.clearRect(0,0,W(),H());const g=c.createLinearGradient(0,0,0,H());g.addColorStop(0,"#1b0e1a");g.addColorStop(1,"#26120d");c.fillStyle=g;c.fillRect(0,0,W(),H());for(let i=0;i<5;i++){c.fillStyle=`rgba(236,72,153,${0.05+0.03*Math.sin(now*0.001+i)})`;c.fillRect(0,60+i*30,W(),8)}c.fillStyle="#331a12";c.fillRect(0,groundY+20,W(),100);c.fillStyle="#3a1f16";c.fillRect(0,groundY,W(),40)}function drawPlayer(){c.save();c.fillStyle="#F59E0B";c.beginPath();c.roundRect(player.x-23,player.y-23,46,46,10);c.fill();c.restore()}function drawObstacles(){obstacles.forEach(o=>{c.save();c.fillStyle=o.type==='cactus'?"#7c3aed":"#ec4899";c.fillRect(o.x,o.y,o.w,o.h);c.restore()})}function drawStars(){c.fillStyle="#ffe08a";stars.forEach(s=>{c.beginPath();c.arc(s.x,s.y,9,0,Math.PI*2);c.fill()})}function drawHUD(){c.fillStyle="rgba(255,255,255,.92)";c.font="20px Inter, Arial";c.fillText(`Score: ${Math.floor(score)}`,16,28);c.fillText(`High: ${high}`,16,52);if(!running){c.textAlign="center";c.font="26px Inter, Arial";c.fillText("Game Over â€” Press R to save & restart",W()/2,H()/2);c.textAlign="start"}}let last=performance.now();function loop(now){const dt=(now-last)/16.67;last=now;drawBG(now);step();drawObstacles();drawStars();drawPlayer();drawHUD();requestAnimationFrame(loop)}requestAnimationFrame(loop);function restart(){high=Math.max(high,Math.floor(score));localStorage.setItem('ar_high',String(high));const lb=JSON.parse(localStorage.getItem('ar_leaderboard')||'[]');lb.push({score:Math.floor(score),at:new Date().toISOString()});lb.sort((a,b)=>b.score-a.score);localStorage.setItem('ar_leaderboard',JSON.stringify(lb.slice(0,50)));running=true;paused=false;score=0;t=0;obstacles.length=0;stars.length=0;player.x=140;player.y=groundY;player.vy=0;player.onGround=true}document.getElementById('btn-pause')?.addEventListener('click',()=>{paused=!paused});document.getElementById('btn-restart')?.addEventListener('click',restart)})();